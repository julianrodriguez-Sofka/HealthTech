{
  "info": {
    "name": "HealthTech API - Complete Collection",
    "description": "Colecci√≥n completa de la API de HealthTech - Sistema de Triage M√©dico\n\n## Caracter√≠sticas:\n- ‚úÖ Tests automatizados en cada endpoint\n- ‚úÖ Validaci√≥n de respuestas\n- ‚úÖ Manejo autom√°tico de tokens\n- ‚úÖ Variables de entorno din√°micas\n\n## Orden de ejecuci√≥n recomendado:\n1. Health Check\n2. Create Users (Admin, Doctor, Nurse)\n3. Login\n4. Patient Operations\n\n## Para ejecutar todos los tests:\n```bash\nnewman run HealthTech-Postman-Collection.json -e HealthTech-Environment.postman_environment.json\n```",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "item": [
    {
      "name": "üè• Health Check",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "// ============================================",
              "// TESTS: Health Check",
              "// ============================================",
              "",
              "pm.test('Status code is 200', function () {",
              "    pm.response.to.have.status(200);",
              "});",
              "",
              "pm.test('Response time is acceptable (< 500ms)', function () {",
              "    pm.expect(pm.response.responseTime).to.be.below(500);",
              "});",
              "",
              "pm.test('Response has status field', function () {",
              "    const response = pm.response.json();",
              "    pm.expect(response).to.have.property('status');",
              "});",
              "",
              "pm.test('System status is healthy', function () {",
              "    const response = pm.response.json();",
              "    const validStatuses = ['ok', 'healthy', 'up', 'running'];",
              "    const status = (response.status || '').toLowerCase();",
              "    pm.expect(validStatuses.some(s => status.includes(s))).to.be.true;",
              "    console.log('‚úÖ System Status:', response.status);",
              "});",
              "",
              "pm.test('Content-Type is JSON', function () {",
              "    pm.expect(pm.response.headers.get('Content-Type')).to.include('application/json');",
              "});"
            ],
            "type": "text/javascript"
          }
        }
      ],
      "request": {
        "method": "GET",
        "header": [],
        "url": {
          "raw": "{{baseUrl}}/health",
          "host": ["{{baseUrl}}"],
          "path": ["health"]
        },
        "description": "Verifica el estado del sistema y servicios conectados"
      },
      "response": []
    },
    {
      "name": "üîê Auth & Users",
      "item": [
        {
          "name": "Create Admin User",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "// ============================================",
                  "// TESTS: Create Admin User",
                  "// ============================================",
                  "",
                  "const response = pm.response.json();",
                  "",
                  "pm.test('User created successfully (201) or already exists (409/400)', function () {",
                  "    pm.expect([201, 200, 409, 400]).to.include(pm.response.code);",
                  "});",
                  "",
                  "if (pm.response.code === 201 || pm.response.code === 200) {",
                  "    pm.test('Response contains user data', function () {",
                  "        pm.expect(response).to.have.property('id');",
                  "        pm.expect(response).to.have.property('email');",
                  "        pm.expect(response).to.have.property('role');",
                  "    });",
                  "",
                  "    pm.test('User role is admin', function () {",
                  "        pm.expect(response.role).to.equal('admin');",
                  "    });",
                  "",
                  "    pm.test('Password is not exposed in response', function () {",
                  "        pm.expect(response).to.not.have.property('password');",
                  "        pm.expect(response).to.not.have.property('passwordHash');",
                  "    });",
                  "",
                  "    // Save admin ID for later use",
                  "    pm.environment.set('adminId', response.id);",
                  "    console.log('‚úÖ Admin user created:', response.email);",
                  "} else {",
                  "    console.log('‚ÑπÔ∏è Admin user might already exist');",
                  "}",
                  "",
                  "pm.test('Response time < 2000ms', function () {",
                  "    pm.expect(pm.response.responseTime).to.be.below(2000);",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"admin@healthtech.com\",\n  \"name\": \"Admin Principal\",\n  \"role\": \"admin\",\n  \"password\": \"Admin123!\"\n}"
            },
            "url": {
              "raw": "{{apiUrl}}/users",
              "host": ["{{apiUrl}}"],
              "path": ["users"]
            },
            "description": "Crea un usuario con rol de administrador"
          },
          "response": []
        },
        {
          "name": "Create Doctor User",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "// ============================================",
                  "// TESTS: Create Doctor User",
                  "// ============================================",
                  "",
                  "const response = pm.response.json();",
                  "",
                  "pm.test('Doctor created successfully (201) or already exists (409/400)', function () {",
                  "    pm.expect([201, 200, 409, 400]).to.include(pm.response.code);",
                  "});",
                  "",
                  "if (pm.response.code === 201 || pm.response.code === 200) {",
                  "    pm.test('Response contains user data', function () {",
                  "        pm.expect(response).to.have.property('id');",
                  "        pm.expect(response).to.have.property('email');",
                  "    });",
                  "",
                  "    pm.test('User role is doctor', function () {",
                  "        pm.expect(response.role).to.equal('doctor');",
                  "    });",
                  "",
                  "    pm.test('Doctor has specialty field', function () {",
                  "        if (response.specialty) {",
                  "            pm.expect(response.specialty).to.be.a('string');",
                  "        }",
                  "    });",
                  "",
                  "    pm.test('Password is not exposed', function () {",
                  "        pm.expect(response).to.not.have.property('password');",
                  "    });",
                  "",
                  "    pm.environment.set('doctorId', response.id);",
                  "    console.log('‚úÖ Doctor created:', response.email);",
                  "} else {",
                  "    console.log('‚ÑπÔ∏è Doctor might already exist');",
                  "}",
                  "",
                  "pm.test('Response time < 2000ms', function () {",
                  "    pm.expect(pm.response.responseTime).to.be.below(2000);",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"doctor@healthtech.com\",\n  \"name\": \"Dr. Juan Garc√≠a\",\n  \"role\": \"doctor\",\n  \"password\": \"Doctor123!\",\n  \"specialty\": \"Medicina General\",\n  \"licenseNumber\": \"MED-12345\"\n}"
            },
            "url": {
              "raw": "{{apiUrl}}/users",
              "host": ["{{apiUrl}}"],
              "path": ["users"]
            },
            "description": "Crea un usuario con rol de doctor"
          },
          "response": []
        },
        {
          "name": "Create Nurse User",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "// ============================================",
                  "// TESTS: Create Nurse User",
                  "// ============================================",
                  "",
                  "const response = pm.response.json();",
                  "",
                  "pm.test('Nurse created successfully (201) or already exists (409/400)', function () {",
                  "    pm.expect([201, 200, 409, 400]).to.include(pm.response.code);",
                  "});",
                  "",
                  "if (pm.response.code === 201 || pm.response.code === 200) {",
                  "    pm.test('Response contains user data', function () {",
                  "        pm.expect(response).to.have.property('id');",
                  "        pm.expect(response).to.have.property('email');",
                  "    });",
                  "",
                  "    pm.test('User role is nurse', function () {",
                  "        pm.expect(response.role).to.equal('nurse');",
                  "    });",
                  "",
                  "    pm.test('Password is not exposed', function () {",
                  "        pm.expect(response).to.not.have.property('password');",
                  "    });",
                  "",
                  "    pm.environment.set('nurseId', response.id);",
                  "    console.log('‚úÖ Nurse created:', response.email);",
                  "} else {",
                  "    console.log('‚ÑπÔ∏è Nurse might already exist');",
                  "}",
                  "",
                  "pm.test('Response time < 2000ms', function () {",
                  "    pm.expect(pm.response.responseTime).to.be.below(2000);",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"nurse@healthtech.com\",\n  \"name\": \"Enfermera Mar√≠a L√≥pez\",\n  \"role\": \"nurse\",\n  \"password\": \"Nurse123!\",\n  \"area\": \"Urgencias\",\n  \"shift\": \"morning\",\n  \"licenseNumber\": \"ENF-54321\"\n}"
            },
            "url": {
              "raw": "{{apiUrl}}/users",
              "host": ["{{apiUrl}}"],
              "path": ["users"]
            },
            "description": "Crea un usuario con rol de enfermera"
          },
          "response": []
        },
        {
          "name": "Login - Admin",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "// ============================================",
                  "// TESTS: Login Admin",
                  "// ============================================",
                  "",
                  "pm.test('Login successful - Status 200', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "const response = pm.response.json();",
                  "",
                  "pm.test('Response contains access token', function () {",
                  "    const token = response.accessToken || response.token;",
                  "    pm.expect(token).to.be.a('string');",
                  "    pm.expect(token.length).to.be.above(20);",
                  "});",
                  "",
                  "pm.test('Token is valid JWT format', function () {",
                  "    const token = response.accessToken || response.token;",
                  "    const parts = token.split('.');",
                  "    pm.expect(parts.length).to.equal(3);",
                  "    console.log('‚úÖ Valid JWT structure');",
                  "});",
                  "",
                  "pm.test('User object is complete', function () {",
                  "    pm.expect(response).to.have.property('user');",
                  "    pm.expect(response.user).to.have.property('id');",
                  "    pm.expect(response.user).to.have.property('email');",
                  "    pm.expect(response.user).to.have.property('role');",
                  "    pm.expect(response.user).to.have.property('name');",
                  "});",
                  "",
                  "pm.test('User role is valid', function () {",
                  "    const validRoles = ['admin', 'doctor', 'nurse'];",
                  "    pm.expect(validRoles).to.include(response.user.role);",
                  "});",
                  "",
                  "pm.test('Password is not exposed', function () {",
                  "    pm.expect(response.user).to.not.have.property('password');",
                  "    pm.expect(response.user).to.not.have.property('passwordHash');",
                  "});",
                  "",
                  "pm.test('Response time < 1000ms', function () {",
                  "    pm.expect(pm.response.responseTime).to.be.below(1000);",
                  "});",
                  "",
                  "// Save token and user info to environment",
                  "if (pm.response.code === 200) {",
                  "    const token = response.accessToken || response.token;",
                  "    pm.environment.set('token', token);",
                  "    pm.environment.set('userId', response.user.id);",
                  "    pm.environment.set('userRole', response.user.role);",
                  "    pm.environment.set('userName', response.user.name);",
                  "    ",
                  "    if (response.refreshToken) {",
                  "        pm.environment.set('refreshToken', response.refreshToken);",
                  "    }",
                  "    ",
                  "    console.log('‚úÖ Token saved successfully');",
                  "    console.log('üë§ User:', response.user.name);",
                  "    console.log('üîë Role:', response.user.role);",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"admin@healthtech.com\",\n  \"password\": \"Admin123!\"\n}"
            },
            "url": {
              "raw": "{{apiUrl}}/auth/login",
              "host": ["{{apiUrl}}"],
              "path": ["auth", "login"]
            },
            "description": "Autentica usuario admin y guarda token JWT autom√°ticamente"
          },
          "response": []
        },
        {
          "name": "Login - Doctor",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "// ============================================",
                  "// TESTS: Login Doctor",
                  "// ============================================",
                  "",
                  "pm.test('Login successful - Status 200', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "const response = pm.response.json();",
                  "",
                  "pm.test('Response contains access token', function () {",
                  "    const token = response.accessToken || response.token;",
                  "    pm.expect(token).to.be.a('string');",
                  "});",
                  "",
                  "pm.test('User role is doctor', function () {",
                  "    pm.expect(response.user.role).to.equal('doctor');",
                  "});",
                  "",
                  "// Save doctor token",
                  "if (pm.response.code === 200) {",
                  "    const token = response.accessToken || response.token;",
                  "    pm.environment.set('doctorToken', token);",
                  "    pm.environment.set('doctorId', response.user.id);",
                  "    console.log('‚úÖ Doctor token saved');",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"doctor@healthtech.com\",\n  \"password\": \"Doctor123!\"\n}"
            },
            "url": {
              "raw": "{{apiUrl}}/auth/login",
              "host": ["{{apiUrl}}"],
              "path": ["auth", "login"]
            },
            "description": "Autentica usuario doctor y guarda token"
          },
          "response": []
        },
        {
          "name": "Login - Nurse",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "// ============================================",
                  "// TESTS: Login Nurse",
                  "// ============================================",
                  "",
                  "pm.test('Login successful - Status 200', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "const response = pm.response.json();",
                  "",
                  "pm.test('Response contains access token', function () {",
                  "    const token = response.accessToken || response.token;",
                  "    pm.expect(token).to.be.a('string');",
                  "});",
                  "",
                  "pm.test('User role is nurse', function () {",
                  "    pm.expect(response.user.role).to.equal('nurse');",
                  "});",
                  "",
                  "// Save nurse token",
                  "if (pm.response.code === 200) {",
                  "    const token = response.accessToken || response.token;",
                  "    pm.environment.set('nurseToken', token);",
                  "    pm.environment.set('nurseId', response.user.id);",
                  "    console.log('‚úÖ Nurse token saved');",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"nurse@healthtech.com\",\n  \"password\": \"Nurse123!\"\n}"
            },
            "url": {
              "raw": "{{apiUrl}}/auth/login",
              "host": ["{{apiUrl}}"],
              "path": ["auth", "login"]
            },
            "description": "Autentica usuario enfermera y guarda token"
          },
          "response": []
        },
        {
          "name": "Login - Invalid Credentials",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "// ============================================",
                  "// TESTS: Invalid Login - Negative Test",
                  "// ============================================",
                  "",
                  "pm.test('Invalid login returns 401 Unauthorized', function () {",
                  "    pm.expect([401, 400, 403]).to.include(pm.response.code);",
                  "});",
                  "",
                  "pm.test('Response contains error message', function () {",
                  "    const response = pm.response.json();",
                  "    const hasError = response.error || response.message || response.errors;",
                  "    pm.expect(hasError).to.exist;",
                  "    console.log('‚úÖ Error message:', response.error || response.message);",
                  "});",
                  "",
                  "pm.test('No token is returned', function () {",
                  "    const response = pm.response.json();",
                  "    pm.expect(response.accessToken).to.be.undefined;",
                  "    pm.expect(response.token).to.be.undefined;",
                  "});",
                  "",
                  "console.log('‚úÖ Security test passed - Invalid credentials rejected');"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"admin@healthtech.com\",\n  \"password\": \"wrongpassword\"\n}"
            },
            "url": {
              "raw": "{{apiUrl}}/auth/login",
              "host": ["{{apiUrl}}"],
              "path": ["auth", "login"]
            },
            "description": "Test negativo: Verifica que credenciales inv√°lidas son rechazadas"
          },
          "response": []
        },
        {
          "name": "Refresh Token",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "// ============================================",
                  "// TESTS: Refresh Token",
                  "// ============================================",
                  "",
                  "if (pm.response.code === 200) {",
                  "    const response = pm.response.json();",
                  "    ",
                  "    pm.test('New access token received', function () {",
                  "        const token = response.accessToken || response.token;",
                  "        pm.expect(token).to.be.a('string');",
                  "        pm.expect(token.length).to.be.above(20);",
                  "    });",
                  "    ",
                  "    pm.test('New refresh token received', function () {",
                  "        if (response.refreshToken) {",
                  "            pm.expect(response.refreshToken).to.be.a('string');",
                  "        }",
                  "    });",
                  "    ",
                  "    // Update tokens",
                  "    const token = response.accessToken || response.token;",
                  "    pm.environment.set('token', token);",
                  "    if (response.refreshToken) {",
                  "        pm.environment.set('refreshToken', response.refreshToken);",
                  "    }",
                  "    console.log('‚úÖ Tokens refreshed successfully');",
                  "} else {",
                  "    pm.test('Refresh token endpoint exists', function () {",
                  "        pm.expect([200, 401, 404]).to.include(pm.response.code);",
                  "    });",
                  "    console.log('‚ÑπÔ∏è Refresh token failed or not implemented');",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"refreshToken\": \"{{refreshToken}}\"\n}"
            },
            "url": {
              "raw": "{{apiUrl}}/auth/refresh",
              "host": ["{{apiUrl}}"],
              "path": ["auth", "refresh"]
            },
            "description": "Renueva el token de acceso usando refresh token"
          },
          "response": []
        },
        {
          "name": "Get All Users",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "// ============================================",
                  "// TESTS: Get All Users",
                  "// ============================================",
                  "",
                  "pm.test('Status code is 200', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('Response is array', function () {",
                  "    const response = pm.response.json();",
                  "    const users = response._value || response.data || response;",
                  "    pm.expect(users).to.be.an('array');",
                  "    console.log('‚úÖ Found', users.length, 'users');",
                  "});",
                  "",
                  "pm.test('Users have required fields', function () {",
                  "    const response = pm.response.json();",
                  "    const users = response._value || response.data || response;",
                  "    ",
                  "    if (users.length > 0) {",
                  "        const user = users[0];",
                  "        pm.expect(user).to.have.property('id');",
                  "        pm.expect(user).to.have.property('email');",
                  "        pm.expect(user).to.have.property('role');",
                  "    }",
                  "});",
                  "",
                  "pm.test('Passwords are not exposed', function () {",
                  "    const response = pm.response.json();",
                  "    const users = response._value || response.data || response;",
                  "    ",
                  "    users.forEach(user => {",
                  "        pm.expect(user.password).to.be.undefined;",
                  "        pm.expect(user.passwordHash).to.be.undefined;",
                  "    });",
                  "});",
                  "",
                  "pm.test('Response time < 500ms', function () {",
                  "    pm.expect(pm.response.responseTime).to.be.below(500);",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "bearer",
              "bearer": [
                {
                  "key": "token",
                  "value": "{{token}}",
                  "type": "string"
                }
              ]
            },
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{apiUrl}}/users",
              "host": ["{{apiUrl}}"],
              "path": ["users"]
            },
            "description": "Obtiene lista de todos los usuarios (requiere autenticaci√≥n)"
          },
          "response": []
        }
      ]
    },
    {
      "name": "üè• Patients",
      "item": [
        {
          "name": "Register Critical Patient (P1)",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "// ============================================",
                  "// TESTS: Register Critical Patient",
                  "// ============================================",
                  "",
                  "pm.test('Patient registered successfully - Status 201', function () {",
                  "    pm.expect([201, 200]).to.include(pm.response.code);",
                  "});",
                  "",
                  "const response = pm.response.json();",
                  "const patient = response.data || response._value || response;",
                  "",
                  "pm.test('Patient has ID assigned', function () {",
                  "    pm.expect(patient).to.have.property('id');",
                  "    pm.expect(patient.id).to.be.a('string');",
                  "    pm.expect(patient.id.length).to.be.above(0);",
                  "});",
                  "",
                  "pm.test('Priority is calculated automatically', function () {",
                  "    pm.expect(patient).to.have.property('priority');",
                  "    pm.expect(patient.priority).to.be.a('number');",
                  "    pm.expect(patient.priority).to.be.within(1, 5);",
                  "});",
                  "",
                  "pm.test('Critical patient gets priority P1 or P2', function () {",
                  "    // FC > 140 y SpO2 < 90 = CR√çTICO",
                  "    pm.expect(patient.priority).to.be.at.most(2);",
                  "    console.log('‚úÖ Priority assigned:', patient.priority);",
                  "});",
                  "",
                  "pm.test('Patient has all required fields', function () {",
                  "    pm.expect(patient).to.have.property('name');",
                  "    pm.expect(patient).to.have.property('age');",
                  "    pm.expect(patient).to.have.property('status');",
                  "});",
                  "",
                  "pm.test('Vital signs are stored correctly', function () {",
                  "    pm.expect(patient).to.have.property('vitals');",
                  "    pm.expect(patient.vitals).to.have.property('heartRate');",
                  "    pm.expect(patient.vitals).to.have.property('oxygenSaturation');",
                  "    pm.expect(patient.vitals).to.have.property('temperature');",
                  "});",
                  "",
                  "pm.test('Patient status is WAITING', function () {",
                  "    const validStatuses = ['waiting', 'WAITING', 'Waiting'];",
                  "    pm.expect(validStatuses.map(s => s.toLowerCase())).to.include(patient.status.toLowerCase());",
                  "});",
                  "",
                  "pm.test('Symptoms are stored as array', function () {",
                  "    pm.expect(patient).to.have.property('symptoms');",
                  "    pm.expect(patient.symptoms).to.be.an('array');",
                  "    pm.expect(patient.symptoms.length).to.be.above(0);",
                  "});",
                  "",
                  "pm.test('Response time < 2000ms', function () {",
                  "    pm.expect(pm.response.responseTime).to.be.below(2000);",
                  "});",
                  "",
                  "// Save patient ID",
                  "pm.environment.set('criticalPatientId', patient.id);",
                  "pm.environment.set('lastPatientId', patient.id);",
                  "console.log('‚úÖ Critical patient registered:', patient.name);",
                  "console.log('üìä Priority:', patient.priority, '(1=Critical, 5=Non-urgent)');"
                ],
                "type": "text/javascript"
              }
            },
            {
              "listen": "prerequest",
              "script": {
                "exec": [
                  "// Generate unique patient name",
                  "const timestamp = Date.now();",
                  "pm.environment.set('criticalPatientName', `Mar√≠a L√≥pez Garc√≠a - ${timestamp}`);"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "bearer",
              "bearer": [
                {
                  "key": "token",
                  "value": "{{token}}",
                  "type": "string"
                }
              ]
            },
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"name\": \"{{criticalPatientName}}\",\n  \"age\": 58,\n  \"gender\": \"female\",\n  \"symptoms\": [\"severe chest pain\", \"difficulty breathing\", \"cold sweating\"],\n  \"vitals\": {\n    \"heartRate\": 145,\n    \"bloodPressure\": \"180/110\",\n    \"temperature\": 38.5,\n    \"oxygenSaturation\": 85,\n    \"respiratoryRate\": 28\n  }\n}"
            },
            "url": {
              "raw": "{{apiUrl}}/patients",
              "host": ["{{apiUrl}}"],
              "path": ["patients"]
            },
            "description": "Registra paciente con signos vitales cr√≠ticos:\n- FC > 140 bpm\n- SpO2 < 90%\n\nDebe recibir prioridad P1 o P2 autom√°ticamente."
          },
          "response": []
        },
        {
          "name": "Register Emergency Patient (P2)",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "// ============================================",
                  "// TESTS: Register Emergency Patient (P2)",
                  "// ============================================",
                  "",
                  "pm.test('Patient registered successfully', function () {",
                  "    pm.expect([201, 200]).to.include(pm.response.code);",
                  "});",
                  "",
                  "const response = pm.response.json();",
                  "const patient = response.data || response._value || response;",
                  "",
                  "pm.test('Emergency patient gets priority P2 or P3', function () {",
                  "    // FC > 120, SpO2 < 95 = Emergencia",
                  "    pm.expect(patient.priority).to.be.within(1, 3);",
                  "    console.log('‚úÖ Priority:', patient.priority);",
                  "});",
                  "",
                  "pm.test('Patient has valid vitals', function () {",
                  "    pm.expect(patient.vitals.heartRate).to.equal(125);",
                  "    pm.expect(patient.vitals.oxygenSaturation).to.equal(91);",
                  "});",
                  "",
                  "pm.environment.set('emergencyPatientId', patient.id);",
                  "console.log('‚úÖ Emergency patient registered:', patient.name);"
                ],
                "type": "text/javascript"
              }
            },
            {
              "listen": "prerequest",
              "script": {
                "exec": [
                  "const timestamp = Date.now();",
                  "pm.environment.set('emergencyPatientName', `Carlos Ruiz - ${timestamp}`);"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "bearer",
              "bearer": [
                {
                  "key": "token",
                  "value": "{{token}}",
                  "type": "string"
                }
              ]
            },
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"name\": \"{{emergencyPatientName}}\",\n  \"age\": 45,\n  \"gender\": \"male\",\n  \"symptoms\": [\"high fever\", \"severe headache\", \"body aches\"],\n  \"vitals\": {\n    \"heartRate\": 125,\n    \"bloodPressure\": \"150/95\",\n    \"temperature\": 40.2,\n    \"oxygenSaturation\": 91,\n    \"respiratoryRate\": 24\n  }\n}"
            },
            "url": {
              "raw": "{{apiUrl}}/patients",
              "host": ["{{apiUrl}}"],
              "path": ["patients"]
            },
            "description": "Registra paciente con signos de emergencia (prioridad P2)"
          },
          "response": []
        },
        {
          "name": "Register Urgent Patient (P3)",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "// ============================================",
                  "// TESTS: Register Urgent Patient (P3)",
                  "// ============================================",
                  "",
                  "pm.test('Patient registered successfully', function () {",
                  "    pm.expect([201, 200]).to.include(pm.response.code);",
                  "});",
                  "",
                  "const response = pm.response.json();",
                  "const patient = response.data || response._value || response;",
                  "",
                  "pm.test('Urgent patient gets priority P3 or P4', function () {",
                  "    pm.expect(patient.priority).to.be.within(2, 4);",
                  "    console.log('‚úÖ Priority:', patient.priority);",
                  "});",
                  "",
                  "pm.environment.set('urgentPatientId', patient.id);",
                  "console.log('‚úÖ Urgent patient registered');"
                ],
                "type": "text/javascript"
              }
            },
            {
              "listen": "prerequest",
              "script": {
                "exec": [
                  "const timestamp = Date.now();",
                  "pm.environment.set('urgentPatientName', `Ana Mart√≠nez - ${timestamp}`);"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "bearer",
              "bearer": [
                {
                  "key": "token",
                  "value": "{{token}}",
                  "type": "string"
                }
              ]
            },
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"name\": \"{{urgentPatientName}}\",\n  \"age\": 35,\n  \"gender\": \"female\",\n  \"symptoms\": [\"moderate abdominal pain\", \"nausea\"],\n  \"vitals\": {\n    \"heartRate\": 105,\n    \"bloodPressure\": \"130/85\",\n    \"temperature\": 38.8,\n    \"oxygenSaturation\": 94,\n    \"respiratoryRate\": 20\n  }\n}"
            },
            "url": {
              "raw": "{{apiUrl}}/patients",
              "host": ["{{apiUrl}}"],
              "path": ["patients"]
            },
            "description": "Registra paciente con signos urgentes (prioridad P3)"
          },
          "response": []
        },
        {
          "name": "Register Stable Patient (P5)",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "// ============================================",
                  "// TESTS: Register Stable Patient (P5)",
                  "// ============================================",
                  "",
                  "pm.test('Patient registered successfully', function () {",
                  "    pm.expect([201, 200]).to.include(pm.response.code);",
                  "});",
                  "",
                  "const response = pm.response.json();",
                  "const patient = response.data || response._value || response;",
                  "",
                  "pm.test('Stable patient gets priority P4 or P5', function () {",
                  "    // Signos vitales normales = Prioridad baja",
                  "    pm.expect(patient.priority).to.be.within(4, 5);",
                  "    console.log('‚úÖ Priority:', patient.priority);",
                  "});",
                  "",
                  "pm.test('Vital signs are within normal range', function () {",
                  "    pm.expect(patient.vitals.heartRate).to.be.within(60, 100);",
                  "    pm.expect(patient.vitals.oxygenSaturation).to.be.within(95, 100);",
                  "    pm.expect(patient.vitals.temperature).to.be.within(36, 37.5);",
                  "});",
                  "",
                  "pm.environment.set('stablePatientId', patient.id);",
                  "console.log('‚úÖ Stable patient registered with low priority');"
                ],
                "type": "text/javascript"
              }
            },
            {
              "listen": "prerequest",
              "script": {
                "exec": [
                  "const timestamp = Date.now();",
                  "pm.environment.set('stablePatientName', `Pedro S√°nchez - ${timestamp}`);"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "bearer",
              "bearer": [
                {
                  "key": "token",
                  "value": "{{token}}",
                  "type": "string"
                }
              ]
            },
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"name\": \"{{stablePatientName}}\",\n  \"age\": 28,\n  \"gender\": \"male\",\n  \"symptoms\": [\"mild headache\", \"fatigue\"],\n  \"vitals\": {\n    \"heartRate\": 75,\n    \"bloodPressure\": \"120/80\",\n    \"temperature\": 36.8,\n    \"oxygenSaturation\": 98,\n    \"respiratoryRate\": 16\n  }\n}"
            },
            "url": {
              "raw": "{{apiUrl}}/patients",
              "host": ["{{apiUrl}}"],
              "path": ["patients"]
            },
            "description": "Registra paciente con signos vitales normales (prioridad P5)"
          },
          "response": []
        },
        {
          "name": "Register Patient - Invalid Vitals",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "// ============================================",
                  "// TESTS: Invalid Vitals - Negative Test",
                  "// ============================================",
                  "",
                  "pm.test('Invalid vitals are rejected (400)', function () {",
                  "    pm.expect([400, 422]).to.include(pm.response.code);",
                  "});",
                  "",
                  "pm.test('Response contains error message', function () {",
                  "    const response = pm.response.json();",
                  "    const hasError = response.error || response.message || response.errors;",
                  "    pm.expect(hasError).to.exist;",
                  "    console.log('‚úÖ Validation error:', response.error || response.message);",
                  "});",
                  "",
                  "console.log('‚úÖ Security test passed - Invalid vitals rejected');"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "bearer",
              "bearer": [
                {
                  "key": "token",
                  "value": "{{token}}",
                  "type": "string"
                }
              ]
            },
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"name\": \"Invalid Patient\",\n  \"age\": 30,\n  \"gender\": \"male\",\n  \"symptoms\": [\"test\"],\n  \"vitals\": {\n    \"heartRate\": 500,\n    \"bloodPressure\": \"120/80\",\n    \"temperature\": 60,\n    \"oxygenSaturation\": 150\n  }\n}"
            },
            "url": {
              "raw": "{{apiUrl}}/patients",
              "host": ["{{apiUrl}}"],
              "path": ["patients"]
            },
            "description": "Test negativo: Verifica que signos vitales fuera de rango son rechazados"
          },
          "response": []
        },
        {
          "name": "List All Patients",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "// ============================================",
                  "// TESTS: List All Patients",
                  "// ============================================",
                  "",
                  "pm.test('Status code is 200', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "const response = pm.response.json();",
                  "const patients = response._value || response.data || response;",
                  "",
                  "pm.test('Response is array', function () {",
                  "    pm.expect(patients).to.be.an('array');",
                  "    console.log('‚úÖ Found', patients.length, 'patients');",
                  "});",
                  "",
                  "pm.test('Patients have required structure', function () {",
                  "    if (patients.length > 0) {",
                  "        const patient = patients[0];",
                  "        pm.expect(patient).to.have.property('id');",
                  "        pm.expect(patient).to.have.property('name');",
                  "        pm.expect(patient).to.have.property('priority');",
                  "        console.log('üìù First patient:', patient.name, '- Priority:', patient.priority);",
                  "    }",
                  "});",
                  "",
                  "pm.test('Patients are sorted by priority (lowest first)', function () {",
                  "    if (patients.length > 1) {",
                  "        let isSorted = true;",
                  "        for (let i = 0; i < patients.length - 1; i++) {",
                  "            if (patients[i].priority > patients[i + 1].priority) {",
                  "                isSorted = false;",
                  "                break;",
                  "            }",
                  "        }",
                  "        pm.expect(isSorted).to.be.true;",
                  "        if (isSorted) console.log('‚úÖ Patients correctly sorted by priority');",
                  "    }",
                  "});",
                  "",
                  "pm.test('All patients have valid priority (1-5)', function () {",
                  "    patients.forEach(patient => {",
                  "        pm.expect(patient.priority).to.be.within(1, 5);",
                  "    });",
                  "});",
                  "",
                  "pm.test('Response time < 500ms', function () {",
                  "    pm.expect(pm.response.responseTime).to.be.below(500);",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "bearer",
              "bearer": [
                {
                  "key": "token",
                  "value": "{{token}}",
                  "type": "string"
                }
              ]
            },
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{apiUrl}}/patients",
              "host": ["{{apiUrl}}"],
              "path": ["patients"]
            },
            "description": "Obtiene lista de pacientes ordenados por prioridad"
          },
          "response": []
        },
        {
          "name": "Get Patient by ID",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "// ============================================",
                  "// TESTS: Get Patient by ID",
                  "// ============================================",
                  "",
                  "pm.test('Status code is 200', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "const response = pm.response.json();",
                  "const patient = response._value || response.data || response;",
                  "",
                  "pm.test('Patient has complete information', function () {",
                  "    pm.expect(patient).to.have.property('id');",
                  "    pm.expect(patient).to.have.property('name');",
                  "    pm.expect(patient).to.have.property('age');",
                  "    pm.expect(patient).to.have.property('gender');",
                  "    pm.expect(patient).to.have.property('symptoms');",
                  "    pm.expect(patient).to.have.property('vitals');",
                  "    pm.expect(patient).to.have.property('priority');",
                  "    pm.expect(patient).to.have.property('status');",
                  "});",
                  "",
                  "pm.test('Patient ID matches request', function () {",
                  "    const requestedId = pm.environment.get('lastPatientId');",
                  "    pm.expect(patient.id).to.equal(requestedId);",
                  "});",
                  "",
                  "pm.test('Vitals object is complete', function () {",
                  "    pm.expect(patient.vitals).to.have.property('heartRate');",
                  "    pm.expect(patient.vitals).to.have.property('temperature');",
                  "    pm.expect(patient.vitals).to.have.property('oxygenSaturation');",
                  "});",
                  "",
                  "pm.test('Response time < 300ms', function () {",
                  "    pm.expect(pm.response.responseTime).to.be.below(300);",
                  "});",
                  "",
                  "console.log('‚úÖ Patient details:', patient.name);",
                  "console.log('üìä Priority:', patient.priority);",
                  "console.log('üè• Status:', patient.status);"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "bearer",
              "bearer": [
                {
                  "key": "token",
                  "value": "{{token}}",
                  "type": "string"
                }
              ]
            },
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{apiUrl}}/patients/{{lastPatientId}}",
              "host": ["{{apiUrl}}"],
              "path": ["patients", "{{lastPatientId}}"]
            },
            "description": "Obtiene detalles completos de un paciente espec√≠fico"
          },
          "response": []
        },
        {
          "name": "Get Patient - Not Found",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "// ============================================",
                  "// TESTS: Patient Not Found - Negative Test",
                  "// ============================================",
                  "",
                  "pm.test('Non-existent patient returns 404', function () {",
                  "    pm.expect([404, 400]).to.include(pm.response.code);",
                  "});",
                  "",
                  "pm.test('Response contains error message', function () {",
                  "    const response = pm.response.json();",
                  "    const hasError = response.error || response.message;",
                  "    pm.expect(hasError).to.exist;",
                  "});",
                  "",
                  "console.log('‚úÖ 404 handling test passed');"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "bearer",
              "bearer": [
                {
                  "key": "token",
                  "value": "{{token}}",
                  "type": "string"
                }
              ]
            },
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{apiUrl}}/patients/non-existent-id-12345",
              "host": ["{{apiUrl}}"],
              "path": ["patients", "non-existent-id-12345"]
            },
            "description": "Test negativo: Verifica manejo de paciente no encontrado"
          },
          "response": []
        },
        {
          "name": "Update Patient Status",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "// ============================================",
                  "// TESTS: Update Patient Status",
                  "// ============================================",
                  "",
                  "pm.test('Status updated successfully', function () {",
                  "    pm.expect([200, 204]).to.include(pm.response.code);",
                  "});",
                  "",
                  "if (pm.response.code === 200) {",
                  "    const response = pm.response.json();",
                  "    const patient = response._value || response.data || response;",
                  "    ",
                  "    pm.test('Status is updated to in_progress', function () {",
                  "        pm.expect(patient.status.toLowerCase()).to.equal('in_progress');",
                  "    });",
                  "    ",
                  "    console.log('‚úÖ Patient status updated to:', patient.status);",
                  "}",
                  "",
                  "pm.test('Response time < 500ms', function () {",
                  "    pm.expect(pm.response.responseTime).to.be.below(500);",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "bearer",
              "bearer": [
                {
                  "key": "token",
                  "value": "{{token}}",
                  "type": "string"
                }
              ]
            },
            "method": "PATCH",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"status\": \"in_progress\"\n}"
            },
            "url": {
              "raw": "{{apiUrl}}/patients/{{lastPatientId}}/status",
              "host": ["{{apiUrl}}"],
              "path": ["patients", "{{lastPatientId}}", "status"]
            },
            "description": "Actualiza el estado de un paciente"
          },
          "response": []
        },
        {
          "name": "Add Comment to Patient",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "// ============================================",
                  "// TESTS: Add Comment to Patient",
                  "// ============================================",
                  "",
                  "pm.test('Comment added successfully', function () {",
                  "    pm.expect([200, 201]).to.include(pm.response.code);",
                  "});",
                  "",
                  "if (pm.response.code === 200 || pm.response.code === 201) {",
                  "    const response = pm.response.json();",
                  "    const patient = response._value || response.data || response;",
                  "    ",
                  "    pm.test('Patient has comments array', function () {",
                  "        if (patient.comments) {",
                  "            pm.expect(patient.comments).to.be.an('array');",
                  "            pm.expect(patient.comments.length).to.be.above(0);",
                  "        }",
                  "    });",
                  "    ",
                  "    pm.test('Comment has required fields', function () {",
                  "        if (patient.comments && patient.comments.length > 0) {",
                  "            const lastComment = patient.comments[patient.comments.length - 1];",
                  "            pm.expect(lastComment).to.have.property('content');",
                  "            console.log('‚úÖ Comment added:', lastComment.content.substring(0, 50) + '...');",
                  "        }",
                  "    });",
                  "}",
                  "",
                  "pm.test('Response time < 500ms', function () {",
                  "    pm.expect(pm.response.responseTime).to.be.below(500);",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "bearer",
              "bearer": [
                {
                  "key": "token",
                  "value": "{{token}}",
                  "type": "string"
                }
              ]
            },
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"content\": \"Paciente presenta mejor√≠a en signos vitales. Saturaci√≥n estable. Se recomienda observaci√≥n por 4 horas adicionales.\",\n  \"type\": \"observation\"\n}"
            },
            "url": {
              "raw": "{{apiUrl}}/patients/{{lastPatientId}}/comments",
              "host": ["{{apiUrl}}"],
              "path": ["patients", "{{lastPatientId}}", "comments"]
            },
            "description": "Agrega un comentario m√©dico al paciente"
          },
          "response": []
        },
        {
          "name": "Assign Doctor to Patient",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "// ============================================",
                  "// TESTS: Assign Doctor to Patient",
                  "// ============================================",
                  "",
                  "pm.test('Doctor assigned successfully', function () {",
                  "    pm.expect([200, 201, 204]).to.include(pm.response.code);",
                  "});",
                  "",
                  "if (pm.response.code === 200) {",
                  "    const response = pm.response.json();",
                  "    const patient = response._value || response.data || response;",
                  "    ",
                  "    pm.test('Patient has assigned doctor', function () {",
                  "        if (patient.assignedDoctorId) {",
                  "            pm.expect(patient.assignedDoctorId).to.be.a('string');",
                  "        }",
                  "    });",
                  "    ",
                  "    console.log('‚úÖ Doctor assigned to patient');",
                  "}",
                  "",
                  "pm.test('Response time < 500ms', function () {",
                  "    pm.expect(pm.response.responseTime).to.be.below(500);",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "bearer",
              "bearer": [
                {
                  "key": "token",
                  "value": "{{token}}",
                  "type": "string"
                }
              ]
            },
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"doctorId\": \"{{doctorId}}\"\n}"
            },
            "url": {
              "raw": "{{apiUrl}}/patients/{{lastPatientId}}/assign-doctor",
              "host": ["{{apiUrl}}"],
              "path": ["patients", "{{lastPatientId}}", "assign-doctor"]
            },
            "description": "Asigna un doctor a un paciente"
          },
          "response": []
        },
        {
          "name": "Update Patient Process",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "// ============================================",
                  "// TESTS: Update Patient Process",
                  "// ============================================",
                  "",
                  "pm.test('Process updated successfully', function () {",
                  "    pm.expect([200, 204]).to.include(pm.response.code);",
                  "});",
                  "",
                  "if (pm.response.code === 200) {",
                  "    const response = pm.response.json();",
                  "    const patient = response._value || response.data || response;",
                  "    ",
                  "    pm.test('Process is set correctly', function () {",
                  "        if (patient.process) {",
                  "            pm.expect(patient.process).to.equal('hospitalization');",
                  "        }",
                  "    });",
                  "    ",
                  "    console.log('‚úÖ Patient process updated');",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "bearer",
              "bearer": [
                {
                  "key": "token",
                  "value": "{{token}}",
                  "type": "string"
                }
              ]
            },
            "method": "PATCH",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"process\": \"hospitalization\"\n}"
            },
            "url": {
              "raw": "{{apiUrl}}/patients/{{lastPatientId}}/process",
              "host": ["{{apiUrl}}"],
              "path": ["patients", "{{lastPatientId}}", "process"]
            },
            "description": "Actualiza el proceso/destino del paciente"
          },
          "response": []
        }
      ]
    },
    {
      "name": "üë®‚Äç‚öïÔ∏è Doctor Operations",
      "item": [
        {
          "name": "Get My Patients (Doctor)",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "// ============================================",
                  "// TESTS: Get Doctor's Patients",
                  "// ============================================",
                  "",
                  "pm.test('Status code is 200', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "const response = pm.response.json();",
                  "const patients = response._value || response.data || response;",
                  "",
                  "pm.test('Response is array', function () {",
                  "    pm.expect(patients).to.be.an('array');",
                  "    console.log('‚úÖ Doctor has', patients.length, 'assigned patients');",
                  "});",
                  "",
                  "pm.test('All patients belong to this doctor', function () {",
                  "    const doctorId = pm.environment.get('doctorId');",
                  "    if (patients.length > 0 && doctorId) {",
                  "        patients.forEach(patient => {",
                  "            if (patient.assignedDoctorId) {",
                  "                pm.expect(patient.assignedDoctorId).to.equal(doctorId);",
                  "            }",
                  "        });",
                  "    }",
                  "});",
                  "",
                  "pm.test('Response time < 500ms', function () {",
                  "    pm.expect(pm.response.responseTime).to.be.below(500);",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "bearer",
              "bearer": [
                {
                  "key": "token",
                  "value": "{{doctorToken}}",
                  "type": "string"
                }
              ]
            },
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{apiUrl}}/doctors/{{doctorId}}/patients",
              "host": ["{{apiUrl}}"],
              "path": ["doctors", "{{doctorId}}", "patients"]
            },
            "description": "Obtiene los pacientes asignados al doctor autenticado"
          },
          "response": []
        }
      ]
    },
    {
      "name": "üîí Security Tests",
      "item": [
        {
          "name": "Access Without Token",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "// ============================================",
                  "// TESTS: Security - No Token",
                  "// ============================================",
                  "",
                  "pm.test('Request without token is rejected', function () {",
                  "    pm.expect([401, 403]).to.include(pm.response.code);",
                  "});",
                  "",
                  "pm.test('Response contains auth error', function () {",
                  "    const response = pm.response.json();",
                  "    const hasError = response.error || response.message;",
                  "    pm.expect(hasError).to.exist;",
                  "});",
                  "",
                  "pm.test('No sensitive data exposed', function () {",
                  "    const response = pm.response.json();",
                  "    pm.expect(response.patients).to.be.undefined;",
                  "    pm.expect(response.data).to.be.undefined;",
                  "});",
                  "",
                  "console.log('‚úÖ Security test passed - Unauthorized access blocked');"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{apiUrl}}/patients",
              "host": ["{{apiUrl}}"],
              "path": ["patients"]
            },
            "description": "Test de seguridad: Acceso sin token debe ser rechazado"
          },
          "response": []
        },
        {
          "name": "Access With Invalid Token",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "// ============================================",
                  "// TESTS: Security - Invalid Token",
                  "// ============================================",
                  "",
                  "pm.test('Request with invalid token is rejected', function () {",
                  "    pm.expect([401, 403]).to.include(pm.response.code);",
                  "});",
                  "",
                  "pm.test('Response indicates invalid token', function () {",
                  "    const response = pm.response.json();",
                  "    const hasError = response.error || response.message;",
                  "    pm.expect(hasError).to.exist;",
                  "});",
                  "",
                  "console.log('‚úÖ Security test passed - Invalid token rejected');"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "bearer",
              "bearer": [
                {
                  "key": "token",
                  "value": "invalid.token.here",
                  "type": "string"
                }
              ]
            },
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{apiUrl}}/patients",
              "host": ["{{apiUrl}}"],
              "path": ["patients"]
            },
            "description": "Test de seguridad: Token inv√°lido debe ser rechazado"
          },
          "response": []
        },
        {
          "name": "SQL Injection Test",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "// ============================================",
                  "// TESTS: Security - SQL Injection",
                  "// ============================================",
                  "",
                  "pm.test('SQL injection is prevented', function () {",
                  "    // Should return 400 (bad request) or 404, NOT 500 (server error)",
                  "    pm.expect([400, 404, 422]).to.include(pm.response.code);",
                  "});",
                  "",
                  "pm.test('No SQL error exposed', function () {",
                  "    const responseText = pm.response.text().toLowerCase();",
                  "    pm.expect(responseText).to.not.include('sql');",
                  "    pm.expect(responseText).to.not.include('syntax');",
                  "    pm.expect(responseText).to.not.include('query');",
                  "});",
                  "",
                  "console.log('‚úÖ Security test passed - SQL injection prevented');"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "bearer",
              "bearer": [
                {
                  "key": "token",
                  "value": "{{token}}",
                  "type": "string"
                }
              ]
            },
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{apiUrl}}/patients/1' OR '1'='1",
              "host": ["{{apiUrl}}"],
              "path": ["patients", "1' OR '1'='1"]
            },
            "description": "Test de seguridad: Intento de SQL injection"
          },
          "response": []
        }
      ]
    }
  ],
  "event": [
    {
      "listen": "prerequest",
      "script": {
        "exec": [
          "// ============================================",
          "// GLOBAL PRE-REQUEST SCRIPT",
          "// ============================================",
          "",
          "// Set timestamp for unique data",
          "pm.environment.set('timestamp', Date.now());",
          "",
          "// Log request info",
          "console.log('üöÄ Request:', pm.info.requestName);",
          "console.log('üìç URL:', pm.request.url.toString());"
        ],
        "type": "text/javascript"
      }
    },
    {
      "listen": "test",
      "script": {
        "exec": [
          "// ============================================",
          "// GLOBAL TEST SCRIPT",
          "// ============================================",
          "",
          "// Log response info",
          "console.log('üìä Status:', pm.response.code);",
          "console.log('‚è±Ô∏è Time:', pm.response.responseTime, 'ms');",
          "",
          "// Global test: Response should be JSON",
          "pm.test('Response is valid JSON', function () {",
          "    pm.response.to.be.json;",
          "});"
        ],
        "type": "text/javascript"
      }
    }
  ],
  "variable": [
    {
      "key": "baseUrl",
      "value": "http://localhost:3000",
      "type": "string"
    },
    {
      "key": "apiUrl",
      "value": "http://localhost:3000/api/v1",
      "type": "string"
    }
  ]
}
