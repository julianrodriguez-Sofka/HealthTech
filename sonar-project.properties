# ====================================================================
# SonarCloud Configuration - HealthTech
# ====================================================================

# Project identification
sonar.organization=julianrodriguez-sofka
sonar.projectKey=julianrodriguez-Sofka_HealthTech
sonar.projectName=HealthTech
sonar.projectVersion=1.0.0

# Source configuration
sonar.sources=src
sonar.tests=tests
sonar.sourceEncoding=UTF-8

# TypeScript/JavaScript configuration
sonar.typescript.lcov.reportPaths=coverage/lcov.info
sonar.javascript.lcov.reportPaths=coverage/lcov.info

# Test inclusions
sonar.test.inclusions=tests/**/*.spec.ts,tests/**/*.test.ts

# ====================================================================
# EXCLUSIONS
# ====================================================================

# Source exclusions - Avoid noise in reports
sonar.exclusions=\
  node_modules/**,\
  dist/**,\
  coverage/**,\
  **/*.spec.ts,\
  **/*.test.ts,\
  **/node_modules/**,\
  **/*.d.ts,\
  frontend-new/**,\
  playwritgh/**,\
  serenity-e2e/**,\
  scripts/**,\
  **/*.pending,\
  src/infrastructure/openapi/**,\
  src/infrastructure/sockets/**,\
  src/infrastructure/messaging/**

# Coverage exclusions - Files that don't need coverage
sonar.coverage.exclusions=\
  tests/**,\
  **/*.spec.ts,\
  **/*.test.ts,\
  src/index.ts,\
  src/server.ts,\
  src/app.ts,\
  src/infrastructure/**,\
  src/shared/Logger.ts,\
  src/shared/config.ts,\
  src/domain/entities/**,\
  src/domain/observers/**,\
  src/application/observers/**

# Duplication exclusions - Avoid false positives
sonar.cpd.exclusions=\
  tests/**,\
  **/*.spec.ts,\
  **/*.test.ts,\
  src/infrastructure/api/**,\
  src/infrastructure/persistence/**,\
  src/domain/entities/**

# ====================================================================
# SECURITY HOTSPOTS
# ====================================================================
# Ignore security hotspots in infrastructure layer (validated manually)
sonar.issue.ignore.multicriteria=e1,e2,e3,e4,e5,e6

# Ignore crypto randomness in ID generation (using crypto.randomUUID)
sonar.issue.ignore.multicriteria.e1.ruleKey=typescript:S2245
sonar.issue.ignore.multicriteria.e1.resourceKey=**/*.ts

# Ignore password fields in test users (development only)
sonar.issue.ignore.multicriteria.e2.ruleKey=typescript:S2068
sonar.issue.ignore.multicriteria.e2.resourceKey=src/infrastructure/**

# Ignore CORS/security headers in development
sonar.issue.ignore.multicriteria.e3.ruleKey=typescript:S5122
sonar.issue.ignore.multicriteria.e3.resourceKey=src/infrastructure/**

# Ignore regex security (simple email regex, not vulnerable to ReDoS)
sonar.issue.ignore.multicriteria.e4.ruleKey=typescript:S5852
sonar.issue.ignore.multicriteria.e4.resourceKey=**/*.ts

# Ignore auth service security hotspots (validated implementation)
sonar.issue.ignore.multicriteria.e5.ruleKey=typescript:S5542
sonar.issue.ignore.multicriteria.e5.resourceKey=src/application/services/**

# Ignore JWT configuration (validated with secure defaults)
sonar.issue.ignore.multicriteria.e6.ruleKey=typescript:S6290
sonar.issue.ignore.multicriteria.e6.resourceKey=src/application/services/**

# ====================================================================
# QUALITY GATE
# ====================================================================
# Using custom Quality Gate "Healthtech" configured in SonarCloud UI
# To assign: SonarCloud -> Project -> Administration -> Quality Gate -> Select "Healthtech"
#
# Quality Gate "Healthtech" conditions:
# - Coverage: >= 70%
# - Duplicated Lines: <= 3%
# - Maintainability Rating: A
# - Reliability Rating: A
# - Security Hotspots Reviewed: 100%
# - Security Rating: A

# Wait for Quality Gate result
sonar.qualitygate.wait=true
